#!/bin/bash
# Usage: ./find_flag.sh boom

# cd to target dir and rename the format
TARGET_DIR=${1:-.}

echo "[*] Searching in: $TARGET_DIR"
echo

# 1. Tìm các flag nguyên vẹn
echo "[*] Full flags found:"
grep -rhoE "CTF\{[A-Za-z0-9_!@#\$%^&*+\-_=?.]*\}" "$TARGET_DIR" 2>/dev/null | sort -u
echo

# 2. Tìm các mảnh flag (có { hoặc })
echo "[*] Possible flag fragments:"
grep -r -E "CTF\{|}" "$TARGET_DIR" 2>/dev/null \
  | grep -v "fakeflag" \
  | cut -d: -f2- \
  | sort -u > fragments.txt

if [[ -s fragments.txt ]]; then
    cat fragments.txt
    echo
    echo "[*] Joined fragments (raw attempt):"
    tr -d '\n' < fragments.txt | sed 's/CTF/\
CTF/g'
else
    echo "No fragments found."
fi

echo
echo "[*] Done. Check fragments.txt for manual assembly."
